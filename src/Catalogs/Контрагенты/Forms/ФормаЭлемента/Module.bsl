&НаКлиенте
Процедура НаименованиеПриИзменении(Элемент)
    Объект.ПолноеНаименованиеКонтрагента = "ООО """ + Объект.Наименование + """";
КонецПроцедуры

&НаКлиенте
Процедура ИННПриИзменении(Элемент)

    // Определяем, физ лицо или юр лицо
    ФизЛицо = ЭтоФизЛицо(Объект.ТипКонтрагента);

    // Для физлиц КПП не нужен
    Если ФизЛицо Тогда
        Объект.КПП = "";
        Возврат;
    КонецЕсли;

    // Для юрлица — обрезаем ИНН до 10 символов
    Если СтрДлина(Объект.ИНН) > 10 Тогда
        Объект.ИНН = Лев(Объект.ИНН, 10);
    КонецЕсли;

    // Если ИНН пуст — КПП пуст
    Если НЕ ЗначениеЗаполнено(Объект.ИНН) Тогда
        Объект.КПП = "";
        Возврат;
    КонецЕсли;

    // Здесь вызываем как раньше — расчёт КПП по ИНН
    ПересчитатьКПППоИНН();

КонецПроцедуры

&НаКлиенте
Процедура ТипКонтрагентаПриИзменении(Элемент)

    ФизЛицо = ЭтоФизЛицо(Объект.ТипКонтрагента);

    Если ФизЛицо Тогда
        
        Объект.КПП = "";
        Элементы.КПП.Доступность = Ложь;
        Элементы.КПП.Подсказка = "Для физических лиц КПП не заполняется";

    Иначе
        
        Элементы.КПП.Доступность = Истина;
        Элементы.КПП.Подсказка = "";

        Если ЗначениеЗаполнено(Объект.ИНН) Тогда
            ПересчитатьКПППоИНН();
        КонецЕсли;

    КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ПересчитатьКПППоИНН()

    ЗначениеИНН = Объект.ИНН;
    ДлинаИНН = СтрДлина(ЗначениеИНН);

    Если ДлинаИНН = 10 Тогда
        // Юридическое лицо
        Объект.КПП = Лев(ЗначениеИНН, 4) + "01001";
        
    ИначеЕсли ДлинаИНН = 12 Тогда
        // ИП
        Объект.КПП = "";
        
    Иначе
        Объект.КПП = "";
        Если ДлинаИНН > 0 Тогда
            Сообщить("Введен некорректный ИНН. ИНН должен состоять из 10 или 12 цифр.");
        КонецЕсли;
    КонецЕсли;

КонецПроцедуры



&НаСервере
Функция ЭтоФизЛицо(ТипКонтрагента)
    Возврат ТипКонтрагента = Перечисления.ТипыКонтрагентов.ФизическоеЛицо;
КонецФункции
